<link rel="stylesheet" href="style.css" />
<script src="https://cdn.tailwindcss.com"></script>
<div class="flex flex-col gap-4 p-4">
  <h1 class="font-semibold">Figma Stats Tracker</h1>
  <div class="border border-b border-gray-100 w-full"></div>
  <button
    id="startpause"
    class="bg-black rounded h-8 text-white text-xs font-bold"
  >
    Start tracker
  </button>
  <div class="border border-b border-gray-100 w-full"></div>
  <p class="text-sm font-bold uppercase">New</p>

  <div class="grid grid-cols-2 gap-4">
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Groups</p>
      <p class="text-2xl" id="GROUP">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Frames</p>
      <p class="text-2xl" id="FRAME">0</p>
    </div>
  </div>
  <div class="grid grid-cols-2 gap-4">
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Rectangles</p>
      <p class="text-2xl" id="RECTANGLE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Text</p>
      <p class="text-2xl" id="TEXT">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Ellipses</p>
      <p class="text-2xl" id="ELLIPSE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Stars</p>
      <p class="text-2xl" id="STAR">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Polygons</p>
      <p class="text-2xl" id="POLYGON">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Slices</p>
      <p class="text-2xl" id="SLICE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Sections</p>
      <p class="text-2xl" id="SECTION">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Pages</p>
      <p class="text-2xl" id="PAGE">0</p>
    </div>
  </div>

  <div class="border border-b border-gray-100 w-full"></div>
  <p class="text-sm font-bold uppercase">Existing in file</p>
  <div class="grid grid-cols-2 gap-4">
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Groups</p>
      <p class="text-2xl" id="TOTAL_GROUP">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Frames</p>
      <p class="text-2xl" id="TOTAL_FRAME">0</p>
    </div>
  </div>
  <div class="grid grid-cols-2 gap-4">
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Rectangles</p>
      <p class="text-2xl" id="TOTAL_RECTANGLE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Text</p>
      <p class="text-2xl" id="TOTAL_TEXT">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Ellipses</p>
      <p class="text-2xl" id="TOTAL_ELLIPSE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Stars</p>
      <p class="text-2xl" id="TOTAL_STAR">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Polygons</p>
      <p class="text-2xl" id="TOTAL_POLYGON">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Slices</p>
      <p class="text-2xl" id="TOTAL_SLICE">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Sections</p>
      <p class="text-2xl" id="TOTAL_SECTION">0</p>
    </div>
    <div class="flex uppercase font-bold flex-col justify-between">
      <p class="text-xs text-gray-500">Pages</p>
      <p class="text-2xl" id="TOTAL_PAGE">0</p>
    </div>
  </div>
</div>

<script>
  let isStarted = false;

  document.querySelector("#startpause").onclick = () => {
    parent.postMessage({ pluginMessage: "start" }, "*");
    if (!isStarted) {
      document.querySelector("#startpause").innerHTML = "Running...";
    } else {
      document.querySelector("#startpause").innerHTML = "Start tracker";
    }
    isStarted = !isStarted;
  };

  onmessage = (event) => {
    let message = event.data.pluginMessage;
    onSetStats(message.nodes);
    onSetAllStats(message.allNodes);
  };

  function onSetStats(nodes) {
    nodes.forEach((node) => {
      console.log(node);
      var ele = document.querySelector("#" + node.type);
      if (ele) {
        ele.innerHTML = onFindAmount(nodes, node.type);
      }
    });
  }
  function onSetAllStats(nodes) {
    nodes.forEach((node) => {
      console.log(node);
      var ele = document.querySelector("#TOTAL_" + node.type);
      if (ele) {
        ele.innerHTML = onFindAmount(nodes, node.type);
      }
    });
  }

  function onFindAmount(nodes, type) {
    let amount = 0;
    nodes.forEach((node) => {
      if (node.type === type) {
        amount = node.amount;
      }
    });
    return amount;
  }
</script>
